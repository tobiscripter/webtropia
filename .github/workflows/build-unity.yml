# This is a basic workflow to help you get started with Actions

name: Unity Build

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "master" branch
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: self-hosted

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      - name: set rights
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      # Cleanup
      - name: "Freeing up disk space for build"
        run: |
          echo "############################################"
          echo "#    Freeing up disk space on CI system    #"
          echo "############################################"
          echo -n "Disk space before:"
          df -h / --output=avail | tail -1
          # https://github.com/apache/flink/blob/master/tools/azure-pipelines/free_disk_space.sh
          rm -rf /usr/share/dotnet/
          # https://github.com/actions/virtual-environments/issues/709#issuecomment-612569242
          rm -rf "/usr/local/share/boost"
          rm -rf "$AGENT_TOOLSDIRECTORY"
          echo -n "Disk space after:"
          df -h / --output=avail | tail -1
          
          
      - uses: actions/checkout@v2

      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: game-ci/unity-builder@v2
        env:
          UNITY_EMAIL: ${{ secrets.UNITY_EMAIL }}
          UNITY_PASSWORD: ${{ secrets.UNITY_PASSWORD }}
          UNITY_SERIAL: ${{ secrets.UNITY_SERIAL }}
        with:
          targetPlatform: Android
          projectPath: frontend/
      - uses: actions/upload-artifact@v2
        with:
          name: Build
          path: build

          
